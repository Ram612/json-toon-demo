<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JSON vs TOON Comparison Tool</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    body {
      padding: 30px;
      max-width: 900px;
      margin: auto;
    }
    textarea {
      height: 180px;
    }
    pre {
      white-space: pre-wrap;
    }
  </style>

</head>
<body>

  <h1 class="mb-4 text-primary">JSON vs TOON Token Comparison Tool</h1>

  <!-- JSON INPUT -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">JSON Input</h4>

      <textarea id="jsonInput" class="form-control mt-2">{
  "products": [
    { "id": "301", "name": "Wireless Mouse", "price": 29.99, "category": "Electronics" },
    { "id": "302", "name": "Mechanical Keyboard", "price": 79.99, "category": "Electronics" },
    { "id": "303", "name": "4K Monitor", "price": 299.99, "category": "Electronics" }
  ]
}</textarea>

      <button class="btn btn-primary mt-3" onclick="calculate()">Calculate</button>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">Results</h4>

      <p><strong>JSON Tokens:</strong> <span id="jsonTokens">-</span></p>
      <p><strong>TOON Tokens:</strong> <span id="toonTokens">-</span></p>
      <p><strong>Token Savings:</strong> <span id="savings">-</span></p>
    </div>
  </div>

  <!-- TOON OUTPUT -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h4 class="card-title">TOON Output</h4>

      <textarea id="toonOutput" class="form-control" readonly></textarea>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    function estimateTokens(text) {
      if (!text) return 0;
      return Math.ceil(text.split(/\s+/).length * 1.3);
    }

    function convertToTOON(jsonStr) {
      try {
        const obj = JSON.parse(jsonStr);

        if (!obj.products || !Array.isArray(obj.products)) {
          return "Invalid format: expected { products: [...] }";
        }

        const keys = Object.keys(obj.products[0]);
        let toon = `products[${obj.products.length}]{${keys.join(",")}}:\n`;

        obj.products.forEach(item => {
          const row = keys.map(k => item[k]).join(",");
          toon += `  ${row}\n`;
        });

        return toon.trim();
      } catch {
        return "Invalid JSON";
      }
    }

    function calculate() {
      const jsonInput = document.getElementById("jsonInput").value.trim();
      if (!jsonInput) return;

      const toon = convertToTOON(jsonInput);

      const jsonTokens = estimateTokens(jsonInput);
      const toonTokens = estimateTokens(toon);

      const savings = jsonTokens - toonTokens;
      const percent = ((savings / jsonTokens) * 100).toFixed(1);

      document.getElementById("jsonTokens").innerText = jsonTokens;
      document.getElementById("toonTokens").innerText = toonTokens;
      document.getElementById("savings").innerText =
        `${savings} tokens (${percent}% reduction)`;

      document.getElementById("toonOutput").value = toon;
    }
  </script>

</body>
</html>
